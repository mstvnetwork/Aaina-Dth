<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>24/7 Live Channel</title>
<script src="https://cdn.jsdelivr.net"></script>
<style>
    body { margin: 0; background: #0f0f0f; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; }
    .video-wrapper { position: relative; width: 90vw; max-width: 960px; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; }
    video { width: 100%; height: 100%; display: block; pointer-events: none; }
    .controls-container { position: absolute; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 10; }
    .player-btn { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 18px; user-select: none; }
    video::-webkit-media-controls { display: none !important; }
</style>
</head>
<body>

<div class="video-wrapper">
    <video id="video" playsinline muted autoplay disablePictureInPicture controlsList="nodownload noplaybackrate"></video>
    <div class="controls-container">
        <div id="mute-btn" class="player-btn">ðŸ”‡</div>
        <div id="fs-btn" class="player-btn">â›¶</div>
    </div>
</div>

<script>
const playlist = [
    { url: "http://commondatastorage.googleapis.com", duration: 15 },
    { url: "https://afast-trk2-y7l.cdnz.quest", duration: 5128 }
];

const totalPlaylistDuration = playlist.reduce((acc, item) => acc + item.duration, 0);
const CHANNEL_START = new Date("2026-01-01T00:00:00Z").getTime();
const video = document.getElementById("video");
let hls = null;
let currentUrl = "";

function getLiveState() {
    const elapsed = Math.floor((Date.now() - CHANNEL_START) / 1000);
    const loopPosition = elapsed % totalPlaylistDuration;
    let accumulatedTime = 0;
    for (let i = 0; i < playlist.length; i++) {
        if (loopPosition < accumulatedTime + playlist[i].duration) {
            return { url: playlist[i].url, seekTime: loopPosition - accumulatedTime };
        }
        accumulatedTime += playlist[i].duration;
    }
    return { url: playlist[0].url, seekTime: 0 };
}

function loadMedia() {
    const state = getLiveState();
    if (currentUrl === state.url) return;

    currentUrl = state.url;
    if (hls) { hls.destroy(); hls = null; }

    if (state.url.includes(".m3u8")) {
        if (Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(state.url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        }
    } else {
        video.src = state.url;
        video.load();
    }
}

// Crucial: Only seek once the media is actually ready to be moved
video.addEventListener('canplay', function once() {
    const state = getLiveState();
    video.currentTime = state.seekTime;
    video.play().catch(() => {});
}, { once: true });

// Strict Seek Lock
video.addEventListener('seeking', () => {
    const state = getLiveState();
    if (Math.abs(video.currentTime - state.seekTime) > 2) {
        video.currentTime = state.seekTime;
    }
});

// Regular Sync
setInterval(() => {
    const state = getLiveState();
    if (currentUrl !== state.url) {
        loadMedia();
    } else if (Math.abs(video.currentTime - state.seekTime) > 3) {
        video.currentTime = state.seekTime;
    }
}, 2000);

// UI Controls
document.getElementById("mute-btn").addEventListener("click", () => {
    video.muted = !video.muted;
    document.getElementById("mute-btn").textContent = video.muted ? "ðŸ”‡" : "ðŸ”Š";
});

document.getElementById("fs-btn").addEventListener("click", () => {
    const wrapper = document.querySelector(".video-wrapper");
    if (!document.fullscreenElement) wrapper.requestFullscreen?.() || wrapper.webkitRequestFullscreen?.();
    else document.exitFullscreen?.() || document.webkitExitFullscreen?.();
});

window.onload = loadMedia;
</script>
</body>
</html>
