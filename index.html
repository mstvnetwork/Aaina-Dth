<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>24/7 Live Channel</title>
<script src="https://cdn.jsdelivr.net"></script>
<style>
    body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; overflow: hidden; }
    .video-wrapper { position: relative; width: 100vw; max-width: 960px; aspect-ratio: 16/9; background: #000; }
    
    video { width: 100%; height: 100%; display: block; background: #000; }
    
    /* INTERACTION BLOCKER: Sits over the video to block browser-specific HUDs */
    .interaction-blocker { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; background: transparent; }

    /* OVERLAY: Required for Mobile Autoplay bypass */
    #start-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; display: flex; justify-content: center; align-items: center; }
    #start-btn { padding: 15px 30px; font-size: 18px; color: white; border: 2px solid white; background: none; border-radius: 50px; cursor: pointer; }

    .controls-container { position: absolute; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 10; }
    .player-btn { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 18px; }
    
    /* Force hide any possible browser elements */
    video::-webkit-media-controls { display: none !important; }
</style>
</head>
<body>

<div id="start-overlay">
    <button id="start-btn">TAP TO ENTER CHANNEL</button>
</div>

<div class="video-wrapper">
    <!-- Blocker prevents user from touching/seeking on the native progress bar -->
    <div class="interaction-blocker"></div>
    <video id="video" playsinline muted autoplay disablePictureInPicture controlsList="nodownload noplaybackrate"></video>
    <div class="controls-container">
        <div id="mute-btn" class="player-btn">ðŸ”‡</div>
        <div id="fs-btn" class="player-btn">â›¶</div>
    </div>
</div>

<script>
const playlist = [
    { url: "http://commondatastorage.googleapis.com", duration: 15 },
    { url: "https://afast-trk2-y7l.cdnz.quest", duration: 5128 }
];

const totalPlaylistDuration = playlist.reduce((acc, item) => acc + item.duration, 0);
const CHANNEL_START = new Date("2026-01-01T00:00:00Z").getTime();
const video = document.getElementById("video");
const startOverlay = document.getElementById("start-overlay");
let hls = null;
let currentUrl = "";

function getLiveState() {
    const elapsed = Math.floor((Date.now() - CHANNEL_START) / 1000);
    const loopPosition = elapsed % totalPlaylistDuration;
    let accumulatedTime = 0;
    for (let i = 0; i < playlist.length; i++) {
        if (loopPosition < accumulatedTime + playlist[i].duration) {
            return { url: playlist[i].url, seekTime: loopPosition - accumulatedTime };
        }
        accumulatedTime += playlist[i].duration;
    }
    return { url: playlist[0].url, seekTime: 0 };
}

function loadAndSync() {
    const state = getLiveState();
    if (currentUrl !== state.url) {
        currentUrl = state.url;
        if (hls) { hls.destroy(); hls = null; }
        if (state.url.includes(".m3u8") && Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(state.url);
            hls.attachMedia(video);
        } else {
            video.src = state.url;
        }
    }
    // Only update if drift is > 2 seconds
    if (Math.abs(video.currentTime - state.seekTime) > 2) {
        video.currentTime = state.seekTime;
    }
    video.play().catch(() => {});
}

// Start button bypasses browser autoplay blocking
document.getElementById("start-btn").addEventListener("click", () => {
    startOverlay.style.display = "none";
    loadAndSync();
    // Start strict sync loop
    setInterval(loadAndSync, 2000);
});

// Strict Seek Lock (Universal)
video.addEventListener('seeking', () => {
    const state = getLiveState();
    video.currentTime = state.seekTime;
});

// UI Logic
document.getElementById("mute-btn").addEventListener("click", () => {
    video.muted = !video.muted;
    document.getElementById("mute-btn").textContent = video.muted ? "ðŸ”‡" : "ðŸ”Š";
});

document.getElementById("fs-btn").addEventListener("click", () => {
    const wrapper = document.querySelector(".video-wrapper");
    if (!document.fullscreenElement) wrapper.requestFullscreen?.() || wrapper.webkitRequestFullscreen?.();
    else document.exitFullscreen?.() || document.webkitExitFullscreen?.();
});
</script>
</body>
</html>
